{% extends "base.html" %}

{% block title %}Dashboard de Analítica{% endblock %}

{% block content %}
<style>
    .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .metric-card { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; }
    .metric-card h3 { margin-top: 0; color: #007bff; }
    .metric-card .value { font-size: 2.5em; font-weight: bold; color: #333; }
    .plots { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
    .plot-container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; }
    .location-lists { display: flex; justify-content: space-around; gap: 20px; margin-top: 20px; }
    .location-lists ul { list-style-type: none; padding: 0; }
    .location-lists li { background-color: #f1f1f1; margin: 5px 0; padding: 8px; border-radius: 4px; }
    img { max-width: 100%; height: auto; }
</style>

<h1>Dashboard de Analítica de Crímenes</h1>

{% if metrics %}
    <h2>Métricas Generales del Modelo</h2>
    <div class="metrics-grid">
        <div class="metric-card">
            <h3>Precisión General (Accuracy)</h3>
            <div class="value">{{ "%.2f"|format(metrics.model_performance.accuracy * 100) }}%</div>
        </div>
        <div class="metric-card">
            <h3>Precisión Ponderada</h3>
            <div class="value">{{ "%.2f"|format(metrics.model_performance['weighted avg'].precision * 100) }}%</div>
        </div>
        <div class="metric-card">
            <h3>Recall Ponderado</h3>
            <div class="value">{{ "%.2f"|format(metrics.model_performance['weighted avg'].recall * 100) }}%</div>
        </div>
    </div>

    <h2>Análisis de Lugares</h2>
    <div class="metric-card location-lists">
        <div>
            <h3>Top 5 Lugares Más Peligrosos</h3>
            <ul>
                {% for loc, count in metrics.location_analysis.most_dangerous.items() %}
                    <li>{{ loc }} ({{ count }} incidentes)</li>
                {% endfor %}
            </ul>
        </div>
        <div>
            <h3>Top 5 Lugares Menos Peligrosos</h3>
            <ul>
                 {% for loc, count in metrics.location_analysis.least_dangerous.items() %}
                    <li>{{ loc }} ({{ count }} incidentes)</li>
                {% endfor %}
            </ul>
        </div>
    </div>
{% endif %}

<div class="plots">
    <div class="plot-container">
        <h2>Top 10 Crímenes Más Comunes</h2>
        <img src="{{ url_for('static', filename='img/crime_distribution.png') }}" alt="Distribución de Crímenes">
    </div>
    <div class="plot-container">
        <h2>Incidentes por Día de la Semana</h2>
        <img src="{{ url_for('static', filename='img/crimes_by_day.png') }}" alt="Crímenes por Día">
    </div>
</div>
{% endblock %}