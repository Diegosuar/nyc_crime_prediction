{% extends "layout.html" %}
{% block content %}
<div class="container">
  <div class="bg-light p-5 rounded mb-4">
    <h1>Pron√≥stico de Gravedad del Crimen (Crime Severity Forecast)</h1>
    <p class="lead">Configura las condiciones para estimar la gravedad probable de un incidente. (Set the conditions to estimate the probable severity of an incident.)</p>
  </div>

  <div class="row">
    <div class="col-md-5">
      <h3>Configura las Condiciones (Set Conditions)</h3>
      <div class="card p-4">
        <form method="POST" action="/forecast">
          <div class="mb-3">
            <label for="borough" class="form-label fw-bold">üìç Distrito (Borough)</label>
            <select class="form-select" id="borough" name="borough">
              {% for b in boroughs %}
                <option value="{{ b }}" {% if input_values.borough == b %}selected{% endif %}>{{ b }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label for="day_of_week" class="form-label">üóìÔ∏è D√≠a de la Semana (Day of the Week)</label>
            <select class="form-select" id="day_of_week" name="day_of_week">
              {% for day in days %}
                <option value="{{ day }}" {% if input_values.day_of_week == day %}selected{% endif %}>{{ day }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label for="hour" class="form-label">‚è∞ Hora del D√≠a (Hour): <span id="hour-value" class="fw-bold">{{ input_values.hour or 12 }}</span>:00</label>
            <input type="range" class="form-range" id="hour" name="hour" min="0" max="23" value="{{ input_values.hour or 12 }}" oninput="document.getElementById('hour-value').innerText = this.value;">
          </div>
          <div class="mb-3">
            <label for="premise_type" class="form-label">üè¢ Tipo de Lugar (Premise Type)</label>
            <select class="form-select" id="premise_type" name="premise_type">
              {% for premise in premise_types %}
                <option value="{{ premise }}" {% if input_values.prem_typ_desc == premise %}selected{% endif %}>{{ premise }}</option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="btn btn-primary w-100 mt-3">Predecir Gravedad (Predict Severity)</button>
        </form>
      </div>
    </div>

    <div class="col-md-7">
      <h3>Nivel de Riesgo (Risk Level)</h3>
      <div class="card shadow-sm">
        <div class="card-body p-4">
          
          {% if prediction_results %}
            
            {% for result in prediction_results %}
              <div class="mb-3">
                <div class="d-flex justify-content-between">
                  <span class="fw-bold">{{ result.name }}</span>
                  <span class="fw-bold">{{ result.probability }}%</span>
                </div>
                <div class="progress" style="height: 25px;">

                  {% if result.name == 'FELONY' %}
                    {% set color_class = 'bg-danger' %}
                  {% elif result.name == 'MISDEMEANOR' %}
                    {% set color_class = 'bg-warning text-dark' %}
                  {% else %}
                    {% set color_class = 'bg-success' %}
                  {% endif %}
                  
                  <div class="progress-bar {{ color_class }}" role="progressbar" style="width: 50%;" aria-valuenow="{{ result.probability }}" aria-valuemin="0" aria-valuemax="100">
                    {{ result.probability }}%
                  </div>
                </div>
              </div>
            {% endfor %}
            
            <hr>
            {% set top_prediction = prediction_results[0] %}
            {% if top_prediction.name == 'FELONY' %}
              <div class="alert alert-danger text-center" role="alert">
                Predicci√≥n Principal: <strong>{{ top_prediction.name }}</strong> (Riesgo ALTO).
              </div>
            {% elif top_prediction.name == 'MISDEMEANOR' %}
              <div class="alert alert-warning text-center" role="alert">
                Predicci√≥n Principal: <strong>{{ top_prediction.name }}</strong> (Riesgo MODERADO).
              </div>
            {% else %}
              <div class="alert alert-success text-center" role="alert">
                Predicci√≥n Principal: <strong>{{ top_prediction.name }}</strong> (Riesgo BAJO).
              </div>
            {% endif %}

          {% else %}
            <div class="alert alert-info" role="alert">
              Ajusta los valores y haz clic en "Predecir" para ver el nivel de riesgo.
              (Adjust values and click "Predict" to see the risk level.)
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}